# 데이터 과학을 위한 R 알고리즘



## 1. 기계를 활용한 원주율 계산 [^r-monte-carlo] {#pi}

[^r-monte-carlo]: [Estimating Pi with R via MCS-Dart: A very simple example of numerical integration, illustrated and computed in R.](http://giventhedata.blogspot.kr/2012/09/estimating-pi-with-r-via-mcs-dart-very.html)

컴퓨터를 활용하여 원주율을 계산하기 위해서 사각형 면적과 원면적 비율을 활용하여 원주율($\pi$)를 도출한다.

즉, 가로세로가 2인 사각형내부에 반지름이 1인 원을 내접하여 표현하면 다음과 같이 그려본다.


~~~{.r}
# library(purrr)
# library(shape)
# library(tidyverse)
# library(hrbrthemes)
# library(extrafont)
# loadfonts()

## 1.1. 반지름 1인 원 ------------------------------
r <- 1
par(pty="s")
emptyplot(c(0, 0),frame.plot=r)
plotcircle(r=r, mid=c(0,0), lwd=1, lcol="blue")
lines(x=c(0,1),y=c(0,0), lty=1, col="red")
lines(x=c(-1,1),y=c(0,0), lty=2)
lines(y=c(-1,1),x=c(0,0), lty=2)
axis(1)
axis(2)
text(x=0.5,y=0.2, labels=expression("r=1"), col="red")
~~~

<img src="fig/pi-overview-1.png" style="display: block; margin: auto;" />

피타고라스 정리를 이용하여 원 내부에 위치하면 원 내부면적에 위치하는지를 파악한다.

- $\text{원면적} = \pi \times r^2$
- $\text{정사각형면적} = {(2 \times r)}^2 = 4 \times r^2$

상기 두 면적의 비를 통하여 원주율($\pi$)를 다음과 같이 수식을 정리하여 도출한다.

$$\frac{\text{원 면적}}{\text{정사각형 면적}} = \frac{\pi \times r^2}{4 \times r^2}$$
$\pi$에 관해 수식을 정리하면 다음과 같다.

$$\pi = 4 \times \frac{\text{원 면적}}{\text{정사각형 면적}}$$



~~~{.r}
## 1.2. 피타고라스 정리 ------------------------------
### 원
emptyplot(frame.plot=r)
plotcircle(r=r, mid=c(0,0), lwd=1,lcol="blue")
lines(x=c(0,1),y=c(0,0), lty=1, col="red")
lines(x=c(-1,1),y=c(0,0), lty=2)
lines(y=c(-1,1),x=c(0,0), lty=2)
axis(1)
axis(2)

### 피타고라스 정리
points(x=0.8,y=0.58,col="red", lwd=2)
lines(x=c(0,0.8), y=c(0,0), col="red", lwd=2)
lines(x=c(0.8,0.8), y=c(0,0.58), col="red", lwd=2)
lines(x=c(0,0.8), y=c(0,0.58), col="red", lty=2,lwd=2)
text(x=0.4,y=0.4,"c",col="red")
title(expression(c == sqrt(a^2 + b^2)))
~~~

<img src="fig/pi-Pythagorean-1.png" style="display: block; margin: auto;" />

## 2. 몬테카를로 모의실험  {#r-monte-carlo-sim}

`simulate_pi` 함수를 만들어서 정사각형 길이가 2가 되기 때문에 -1에서 1사이 일양분포(uniform)에서 x, y 좌표 점을 
무작위로 뽑아내서 피타고라스 정리를 활용하여 원 내부에 위치하는지 원 외부에 위치하는지 파악한다.
이를 부울을 R 내부적으로 데이터를 표현하는 특성을 활용하여 더하면 원내부 위치하는 점의 갯수가 되고 이를 
전체 모의실험 횟수로 나누게 되면 원주율을 계산할 수 있다.


~~~{.r}
# 2. 몬테카를로 모의실험 -----------------------

simulate_pi <- function(iter = 1000) {
  
  x_pos <- runif(iter, min=-1, max=1)
  y_pos <- runif(iter, min=-1, max=1)

  xy_pos <- ifelse(x_pos^2 + y_pos^2 <= 1, TRUE, FALSE)
  
  pi_val <- 4*(sum(xy_pos)/iter)
  return(pi_val)
}

simulate_pi(1000000)
~~~



~~~{.output}
[1] 3.137012

~~~



~~~{.r}
# 3. 원주율 값 수렴 시각화  -----------------------
## 3.1. 데이터 준비 -------------------------------
sim_iter_lst <- list()

for(i in 1:10^5) {
  if(i %% 100 == 0) {
    sim_iter_lst[[length(sim_iter_lst)+1]] <- i
  }
}

iter_v <- sim_iter_lst %>% unlist
pi_v <- map(sim_iter_lst, simulate_pi) %>% unlist

pi_df <- data.frame("반복횟수"=iter_v, "원주율"=pi_v)

DT::datatable(pi_df) %>% 
  DT::formatCurrency("원주율", currency ="", interval = 3, mark = ",", digits = 5)
~~~

<!--html_preserve--><div id="htmlwidget-e9838040816ccbb2aba5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e9838040816ccbb2aba5">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934","935","936","937","938","939","940","941","942","943","944","945","946","947","948","949","950","951","952","953","954","955","956","957","958","959","960","961","962","963","964","965","966","967","968","969","970","971","972","973","974","975","976","977","978","979","980","981","982","983","984","985","986","987","988","989","990","991","992","993","994","995","996","997","998","999","1000"],[100,200,300,400,500,600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000,2100,2200,2300,2400,2500,2600,2700,2800,2900,3000,3100,3200,3300,3400,3500,3600,3700,3800,3900,4000,4100,4200,4300,4400,4500,4600,4700,4800,4900,5000,5100,5200,5300,5400,5500,5600,5700,5800,5900,6000,6100,6200,6300,6400,6500,6600,6700,6800,6900,7000,7100,7200,7300,7400,7500,7600,7700,7800,7900,8000,8100,8200,8300,8400,8500,8600,8700,8800,8900,9000,9100,9200,9300,9400,9500,9600,9700,9800,9900,10000,10100,10200,10300,10400,10500,10600,10700,10800,10900,11000,11100,11200,11300,11400,11500,11600,11700,11800,11900,12000,12100,12200,12300,12400,12500,12600,12700,12800,12900,13000,13100,13200,13300,13400,13500,13600,13700,13800,13900,14000,14100,14200,14300,14400,14500,14600,14700,14800,14900,15000,15100,15200,15300,15400,15500,15600,15700,15800,15900,16000,16100,16200,16300,16400,16500,16600,16700,16800,16900,17000,17100,17200,17300,17400,17500,17600,17700,17800,17900,18000,18100,18200,18300,18400,18500,18600,18700,18800,18900,19000,19100,19200,19300,19400,19500,19600,19700,19800,19900,20000,20100,20200,20300,20400,20500,20600,20700,20800,20900,21000,21100,21200,21300,21400,21500,21600,21700,21800,21900,22000,22100,22200,22300,22400,22500,22600,22700,22800,22900,23000,23100,23200,23300,23400,23500,23600,23700,23800,23900,24000,24100,24200,24300,24400,24500,24600,24700,24800,24900,25000,25100,25200,25300,25400,25500,25600,25700,25800,25900,26000,26100,26200,26300,26400,26500,26600,26700,26800,26900,27000,27100,27200,27300,27400,27500,27600,27700,27800,27900,28000,28100,28200,28300,28400,28500,28600,28700,28800,28900,29000,29100,29200,29300,29400,29500,29600,29700,29800,29900,30000,30100,30200,30300,30400,30500,30600,30700,30800,30900,31000,31100,31200,31300,31400,31500,31600,31700,31800,31900,32000,32100,32200,32300,32400,32500,32600,32700,32800,32900,33000,33100,33200,33300,33400,33500,33600,33700,33800,33900,34000,34100,34200,34300,34400,34500,34600,34700,34800,34900,35000,35100,35200,35300,35400,35500,35600,35700,35800,35900,36000,36100,36200,36300,36400,36500,36600,36700,36800,36900,37000,37100,37200,37300,37400,37500,37600,37700,37800,37900,38000,38100,38200,38300,38400,38500,38600,38700,38800,38900,39000,39100,39200,39300,39400,39500,39600,39700,39800,39900,40000,40100,40200,40300,40400,40500,40600,40700,40800,40900,41000,41100,41200,41300,41400,41500,41600,41700,41800,41900,42000,42100,42200,42300,42400,42500,42600,42700,42800,42900,43000,43100,43200,43300,43400,43500,43600,43700,43800,43900,44000,44100,44200,44300,44400,44500,44600,44700,44800,44900,45000,45100,45200,45300,45400,45500,45600,45700,45800,45900,46000,46100,46200,46300,46400,46500,46600,46700,46800,46900,47000,47100,47200,47300,47400,47500,47600,47700,47800,47900,48000,48100,48200,48300,48400,48500,48600,48700,48800,48900,49000,49100,49200,49300,49400,49500,49600,49700,49800,49900,50000,50100,50200,50300,50400,50500,50600,50700,50800,50900,51000,51100,51200,51300,51400,51500,51600,51700,51800,51900,52000,52100,52200,52300,52400,52500,52600,52700,52800,52900,53000,53100,53200,53300,53400,53500,53600,53700,53800,53900,54000,54100,54200,54300,54400,54500,54600,54700,54800,54900,55000,55100,55200,55300,55400,55500,55600,55700,55800,55900,56000,56100,56200,56300,56400,56500,56600,56700,56800,56900,57000,57100,57200,57300,57400,57500,57600,57700,57800,57900,58000,58100,58200,58300,58400,58500,58600,58700,58800,58900,59000,59100,59200,59300,59400,59500,59600,59700,59800,59900,60000,60100,60200,60300,60400,60500,60600,60700,60800,60900,61000,61100,61200,61300,61400,61500,61600,61700,61800,61900,62000,62100,62200,62300,62400,62500,62600,62700,62800,62900,63000,63100,63200,63300,63400,63500,63600,63700,63800,63900,64000,64100,64200,64300,64400,64500,64600,64700,64800,64900,65000,65100,65200,65300,65400,65500,65600,65700,65800,65900,66000,66100,66200,66300,66400,66500,66600,66700,66800,66900,67000,67100,67200,67300,67400,67500,67600,67700,67800,67900,68000,68100,68200,68300,68400,68500,68600,68700,68800,68900,69000,69100,69200,69300,69400,69500,69600,69700,69800,69900,70000,70100,70200,70300,70400,70500,70600,70700,70800,70900,71000,71100,71200,71300,71400,71500,71600,71700,71800,71900,72000,72100,72200,72300,72400,72500,72600,72700,72800,72900,73000,73100,73200,73300,73400,73500,73600,73700,73800,73900,74000,74100,74200,74300,74400,74500,74600,74700,74800,74900,75000,75100,75200,75300,75400,75500,75600,75700,75800,75900,76000,76100,76200,76300,76400,76500,76600,76700,76800,76900,77000,77100,77200,77300,77400,77500,77600,77700,77800,77900,78000,78100,78200,78300,78400,78500,78600,78700,78800,78900,79000,79100,79200,79300,79400,79500,79600,79700,79800,79900,80000,80100,80200,80300,80400,80500,80600,80700,80800,80900,81000,81100,81200,81300,81400,81500,81600,81700,81800,81900,82000,82100,82200,82300,82400,82500,82600,82700,82800,82900,83000,83100,83200,83300,83400,83500,83600,83700,83800,83900,84000,84100,84200,84300,84400,84500,84600,84700,84800,84900,85000,85100,85200,85300,85400,85500,85600,85700,85800,85900,86000,86100,86200,86300,86400,86500,86600,86700,86800,86900,87000,87100,87200,87300,87400,87500,87600,87700,87800,87900,88000,88100,88200,88300,88400,88500,88600,88700,88800,88900,89000,89100,89200,89300,89400,89500,89600,89700,89800,89900,90000,90100,90200,90300,90400,90500,90600,90700,90800,90900,91000,91100,91200,91300,91400,91500,91600,91700,91800,91900,92000,92100,92200,92300,92400,92500,92600,92700,92800,92900,93000,93100,93200,93300,93400,93500,93600,93700,93800,93900,94000,94100,94200,94300,94400,94500,94600,94700,94800,94900,95000,95100,95200,95300,95400,95500,95600,95700,95800,95900,96000,96100,96200,96300,96400,96500,96600,96700,96800,96900,97000,97100,97200,97300,97400,97500,97600,97700,97800,97900,98000,98100,98200,98300,98400,98500,98600,98700,98800,98900,99000,99100,99200,99300,99400,99500,99600,99700,99800,99900,100000],[3.28,3.32,3.22666666666667,3.27,3.192,3.16,3.14285714285714,3.2,3.20888888888889,3.144,3.14181818181818,3.13,3.03076923076923,3.16285714285714,3.18133333333333,3.175,3.13411764705882,3.21333333333333,3.17052631578947,3.126,3.14095238095238,3.07090909090909,3.1095652173913,3.16666666666667,3.1168,3.16307692307692,3.1762962962963,3.18142857142857,3.10896551724138,3.12266666666667,3.15225806451613,3.145,3.14545454545455,3.10941176470588,3.072,3.12666666666667,3.13189189189189,3.11368421052632,3.14666666666667,3.114,3.16585365853659,3.18190476190476,3.12744186046512,3.13727272727273,3.13866666666667,3.12521739130435,3.15574468085106,3.14916666666667,3.16326530612245,3.188,3.13254901960784,3.14769230769231,3.14792452830189,3.17851851851852,3.15490909090909,3.14785714285714,3.13543859649123,3.15655172413793,3.13966101694915,3.144,3.11213114754098,3.15677419354839,3.12571428571429,3.12375,3.14769230769231,3.16666666666667,3.1444776119403,3.16529411764706,3.16753623188406,3.15142857142857,3.15042253521127,3.12277777777778,3.13205479452055,3.15189189189189,3.12586666666667,3.13263157894737,3.12727272727273,3.12871794871795,3.13569620253165,3.1255,3.14716049382716,3.12,3.13397590361446,3.13285714285714,3.14729411764706,3.13302325581395,3.15724137931034,3.12863636363636,3.15595505617978,3.17377777777778,3.14285714285714,3.14304347826087,3.13677419354839,3.16127659574468,3.14357894736842,3.12666666666667,3.12989690721649,3.11387755102041,3.12727272727273,3.1268,3.11960396039604,3.16470588235294,3.14368932038835,3.15846153846154,3.1287619047619,3.13320754716981,3.11401869158879,3.13555555555556,3.15339449541284,3.13890909090909,3.1181981981982,3.1425,3.11929203539823,3.13052631578947,3.15826086956522,3.1448275862069,3.15555555555556,3.16237288135593,3.15428571428571,3.169,3.13123966942149,3.16098360655738,3.13756097560976,3.14677419354839,3.16224,3.15238095238095,3.16,3.1290625,3.12558139534884,3.16123076923077,3.13221374045802,3.14030303030303,3.11127819548872,3.11820895522388,3.14755555555556,3.16058823529412,3.1436496350365,3.13246376811594,3.13611510791367,3.142,3.1290780141844,3.15774647887324,3.14013986013986,3.14194444444444,3.15034482758621,3.13369863013699,3.14040816326531,3.12891891891892,3.14389261744966,3.12426666666667,3.1441059602649,3.13763157894737,3.13830065359477,3.15402597402597,3.13703225806452,3.1525641025641,3.14624203821656,3.15164556962025,3.13836477987421,3.163,3.1311801242236,3.10320987654321,3.15337423312883,3.1309756097561,3.13187878787879,3.14626506024096,3.15089820359281,3.14904761904762,3.16923076923077,3.14023529411765,3.13169590643275,3.13348837209302,3.13849710982659,3.15655172413793,3.14514285714286,3.14340909090909,3.14350282485876,3.1285393258427,3.1331843575419,3.152,3.13171270718232,3.13098901098901,3.13595628415301,3.14586956521739,3.13859459459459,3.12172043010753,3.12855614973262,3.13787234042553,3.14243386243386,3.14147368421053,3.1365445026178,3.15208333333333,3.15129533678756,3.11917525773196,3.1454358974359,3.14408163265306,3.13116751269036,3.17636363636364,3.14532663316583,3.1468,3.14766169154229,3.15663366336634,3.1351724137931,3.15039215686275,3.14653658536585,3.15165048543689,3.14512077294686,3.12826923076923,3.13435406698565,3.15638095238095,3.13611374407583,3.1322641509434,3.13765258215962,3.12504672897196,3.16037209302326,3.13203703703704,3.15447004608295,3.1343119266055,3.12493150684932,3.15236363636364,3.13864253393665,3.14738738738739,3.15264573991031,3.15178571428571,3.12302222222222,3.13557522123894,3.13885462555066,3.1380701754386,3.15196506550218,3.136,3.14735930735931,3.14568965517241,3.12824034334764,3.15196581196581,3.13157446808511,3.12338983050847,3.1304641350211,3.13109243697479,3.15163179916318,3.14,3.15784232365145,3.14165289256198,3.1440329218107,3.14311475409836,3.14955102040816,3.13121951219512,3.15303643724696,3.14887096774194,3.14506024096386,3.13888,3.15601593625498,3.12507936507936,3.12584980237154,3.1444094488189,3.13082352941176,3.131875,3.14023346303502,3.14403100775194,3.15583011583012,3.14030769230769,3.13731800766284,3.1369465648855,3.13201520912548,3.13863636363636,3.13901886792453,3.13624060150376,3.14007490636704,3.12880597014925,3.15063197026022,3.12474074074074,3.14007380073801,3.15397058823529,3.13186813186813,3.14598540145985,3.13236363636364,3.13565217391304,3.15682310469314,3.11726618705036,3.12387096774194,3.14742857142857,3.13508896797153,3.13631205673759,3.14798586572438,3.14014084507042,3.15017543859649,3.14881118881119,3.14606271777003,3.14819444444444,3.13093425605536,3.13931034482759,3.14831615120275,3.1427397260274,3.16873720136519,3.14938775510204,3.14969491525424,3.14891891891892,3.14626262626263,3.13369127516779,3.14408026755853,3.1376,3.14936877076412,3.13152317880795,3.14627062706271,3.14736842105263,3.1344262295082,3.14941176470588,3.15022801302932,3.13792207792208,3.13449838187702,3.14258064516129,3.14186495176849,3.1325641025641,3.12370607028754,3.15783439490446,3.14463492063492,3.13012658227848,3.15129337539432,3.11459119496855,3.15786833855799,3.141625,3.14442367601246,3.14335403726708,3.12024767801858,3.15345679012346,3.13587692307692,3.13079754601227,3.14788990825688,3.14341463414634,3.14358662613982,3.15115151515152,3.14948640483384,3.14168674698795,3.15087087087087,3.13736526946108,3.14316417910448,3.14845238095238,3.13673590504451,3.1298224852071,3.14902654867257,3.14352941176471,3.14639296187683,3.14035087719298,3.11172011661808,3.14127906976744,3.12788405797101,3.14554913294798,3.16080691642651,3.14011494252874,3.13581661891117,3.14388571428571,3.13561253561254,3.15079545454545,3.14617563739377,3.14090395480226,3.1496338028169,3.13,3.15114845938375,3.14379888268156,3.1499721448468,3.15122222222222,3.14759002770083,3.14508287292818,3.14842975206612,3.13637362637363,3.13117808219178,3.13486338797814,3.15106267029973,3.13565217391304,3.13691056910569,3.13243243243243,3.13347708894879,3.13096774193548,3.13908847184987,3.13775401069519,3.14314666666667,3.1436170212766,3.12827586206897,3.13132275132275,3.15377308707124,3.14168421052632,3.1392125984252,3.14638743455497,3.12804177545692,3.13583333333333,3.13485714285714,3.13388601036269,3.14149870801034,3.12381443298969,3.14056555269923,3.13753846153846,3.14598465473146,3.14234693877551,3.12905852417303,3.12954314720812,3.13225316455696,3.13484848484848,3.13521410579345,3.15457286432161,3.12771929824561,3.1326,3.1373566084788,3.13174129353234,3.13439205955335,3.14089108910891,3.13896296296296,3.14325123152709,3.14506142506143,3.13735294117647,3.15325183374083,3.14107317073171,3.14111922141119,3.13543689320388,3.15002421307506,3.14657004830918,3.13098795180723,3.15221153846154,3.14436450839329,3.15511961722488,3.14138424821002,3.13085714285714,3.13140142517815,3.14227488151659,3.13635933806147,3.14198113207547,3.13327058823529,3.14178403755869,3.1480093676815,3.13485981308411,3.14713286713287,3.14279069767442,3.13772621809745,3.13361111111111,3.1494688221709,3.14599078341014,3.13425287356322,3.14091743119266,3.14883295194508,3.13735159817352,3.13931662870159,3.14718181818182,3.14349206349206,3.13809954751131,3.13914221218962,3.14792792792793,3.13150561797753,3.13139013452915,3.14129753914989,3.12366071428571,3.14592427616927,3.13413333333333,3.14722838137472,3.15442477876106,3.14454746136865,3.13198237885463,3.12940659340659,3.12956140350877,3.13242888402626,3.14157205240175,3.14657952069717,3.12747826086957,3.13466377440347,3.14,3.12708423326134,3.15913793103448,3.14778494623656,3.148669527897,3.13781584582441,3.14051282051282,3.12878464818763,3.14740425531915,3.15099787685775,3.14415254237288,3.15331923890063,3.14050632911392,3.13633684210526,3.12899159663866,3.14624737945493,3.15163179916318,3.14789144050104,3.14491666666667,3.1431185031185,3.15186721991701,3.15213250517598,3.13140495867769,3.14259793814433,3.12954732510288,3.1482546201232,3.14254098360656,3.13742331288344,3.13428571428571,3.13873727087576,3.14333333333333,3.14012170385396,3.14963562753036,3.1330101010101,3.15096774193548,3.13545271629779,3.14,3.1314629258517,3.15408,3.13716566866267,3.14717131474104,3.14361829025845,3.14912698412698,3.13544554455446,3.14150197628459,3.13420118343195,3.15133858267717,3.1403536345776,3.13670588235294,3.15178082191781,3.14734375,3.13808966861598,3.1452140077821,3.15130097087379,3.14186046511628,3.1537330754352,3.13606177606178,3.14065510597303,3.14769230769231,3.13642994241843,3.15716475095785,3.11663479923518,3.14450381679389,3.15207619047619,3.14615969581749,3.1392789373814,3.14840909090909,3.14207939508507,3.14384905660377,3.11653483992467,3.14315789473684,3.1422138836773,3.13333333333333,3.14168224299065,3.1455223880597,3.14234636871508,3.14416356877323,3.13736549165121,3.14037037037037,3.13242144177449,3.14715867158672,3.14246777163904,3.13470588235294,3.14040366972477,3.13355311355311,3.15071297989031,3.14306569343066,3.13930783242259,3.12930909090909,3.14831215970962,3.13413043478261,3.14690777576854,3.14505415162455,3.15034234234234,3.14985611510791,3.14017953321364,3.14960573476703,3.14232558139535,3.14385714285714,3.13219251336898,3.14455516014235,3.14458259325044,3.14468085106383,3.14017699115044,3.14120141342756,3.14257495590829,3.14014084507042,3.13989455184534,3.1460350877193,3.15257443082312,3.14223776223776,3.14862129144852,3.13414634146341,3.14768695652174,3.14131944444444,3.14065857885615,3.13820069204152,3.14445595854922,3.13255172413793,3.14134251290878,3.14872852233677,3.13907375643225,3.14308219178082,3.14564102564103,3.14484641638225,3.14562180579216,3.14326530612245,3.1425466893039,3.13681355932203,3.14788494077834,3.14378378378378,3.13848229342327,3.12882154882155,3.13196638655462,3.13496644295302,3.14231155778894,3.15190635451505,3.14871452420701,3.14093333333333,3.1326455906822,3.1446511627907,3.14414593698176,3.14509933774834,3.14280991735537,3.13498349834983,3.13423393739703,3.14269736842105,3.15231527093596,3.13659016393443,3.14441898527005,3.13960784313725,3.14140293637847,3.1442996742671,3.14321951219512,3.13837662337662,3.12965964343598,3.13663430420712,3.13253634894992,3.14283870967742,3.15104669887279,3.13755627009646,3.14285714285714,3.14897435897436,3.139136,3.13354632587859,3.14475279106858,3.13987261146497,3.14302066772655,3.13536507936508,3.14307448494453,3.13829113924051,3.13232227488152,3.14018927444795,3.13215748031496,3.13735849056604,3.13751962323391,3.14081504702194,3.14291079812207,3.1450625,3.14483619344774,3.13919003115265,3.13922239502333,3.15366459627329,3.14914728682171,3.14681114551084,3.13786707882535,3.14197530864198,3.14545454545455,3.14363076923077,3.13751152073733,3.14269938650307,3.13880551301685,3.13449541284404,3.14760305343511,3.13262195121951,3.15732115677321,3.14620060790274,3.14257966616085,3.14006060606061,3.13561270801815,3.1366163141994,3.14141779788839,3.13795180722892,3.14448120300752,3.1427027027027,3.14062968515742,3.1322754491018,3.15282511210762,3.1489552238806,3.13281669150522,3.13982142857143,3.14419019316493,3.1393471810089,3.1504,3.13236686390533,3.14257016248154,3.14713864306785,3.14085419734904,3.14817647058824,3.13773861967695,3.14785923753666,3.15115666178624,3.1366081871345,3.13991240875912,3.14274052478134,3.12395924308588,3.14779069767442,3.14165457184325,3.14521739130435,3.13962373371925,3.13138728323699,3.13627705627706,3.14224783861671,3.13559712230216,3.14465517241379,3.14186513629842,3.14853868194842,3.15547925608011,3.14182857142857,3.14659058487874,3.1417094017094,3.14128022759602,3.12846590909091,3.15937588652482,3.1299716713881,3.13374823196605,3.13661016949153,3.13540197461213,3.13678873239437,3.14115330520394,3.13393258426966,3.14793828892006,3.14067226890756,3.14433566433566,3.14072625698324,3.14806136680614,3.13877437325905,3.15432545201669,3.14711111111111,3.14058252427184,3.14282548476454,3.14107883817427,3.14491712707182,3.1432275862069,3.13101928374656,3.15328748280605,3.13796703296703,3.14480109739369,3.15216438356164,3.13351573187414,3.14699453551913,3.12638472032742,3.13722070844687,3.13899319727891,3.14141304347826,3.14350067842605,3.1359891598916,3.14127198917456,3.13956756756757,3.14364372469636,3.14053908355795,3.14621803499327,3.14284946236559,3.14593288590604,3.13635388739946,3.12995983935743,3.14470588235294,3.14600801068091,3.15045333333333,3.14018641810919,3.14164893617021,3.1465604249668,3.14525198938992,3.13350993377483,3.14243386243386,3.15170409511229,3.14263852242744,3.14835309617918,3.14473684210526,3.14002628120894,3.14472440944882,3.15349934469201,3.14371727748691,3.14013071895425,3.14161879895561,3.15144719687093,3.12973958333333,3.14954486345904,3.13761038961039,3.14889753566796,3.14259067357513,3.1477360931436,3.1497157622739,3.13976774193548,3.14345360824742,3.14769626769627,3.12694087403599,3.13525032092426,3.14220512820513,3.14043533930858,3.13217391304348,3.13966794380587,3.14413265306122,3.14338853503185,3.13521628498728,3.14505717916137,3.13517766497462,3.14357414448669,3.1500253164557,3.14579013906448,3.13525252525253,3.14103404791929,3.13405541561713,3.14465408805031,3.14442211055276,3.14278544542033,3.14982456140351,3.13892365456821,3.14185,3.13573033707865,3.13910224438903,3.1385305105853,3.13597014925373,3.13078260869565,3.13374689826303,3.12951672862454,3.14094059405941,3.14487021013597,3.14251851851852,3.14441430332922,3.13029556650246,3.14642066420664,3.13542997542998,3.13541104294479,3.14137254901961,3.14345165238678,3.14601466992665,3.13387057387057,3.14390243902439,3.1452862362972,3.15114355231144,3.13623329283111,3.13669902912621,3.14293333333333,3.13680387409201,3.14577992744861,3.14202898550725,3.14147165259349,3.1470843373494,3.13737665463297,3.13293269230769,3.13709483793517,3.13270983213429,3.1339880239521,3.14971291866029,3.1394504181601,3.15040572792363,3.14245530393325,3.13509523809524,3.14297265160523,3.1329216152019,3.13954922894425,3.14260663507109,3.13708875739645,3.13631205673759,3.13974025974026,3.13235849056604,3.13785630153121,3.14423529411765,3.13541715628672,3.14718309859155,3.13542790152403,3.15531615925059,3.13445614035088,3.13028037383178,3.13964994165694,3.13981351981352,3.14202561117579,3.14623255813953,3.14355400696864,3.14491879350348,3.13821552723059,3.1400462962963,3.14450867052023,3.13575057736721,3.14168396770473,3.13792626728111,3.14568469505178,3.13802298850575,3.13832376578645,3.13321100917431,3.14620847651775,3.14045766590389,3.13472,3.14086757990868,3.15096921322691,3.14041002277904,3.14534698521047,3.14527272727273,3.14960272417707,3.14190476190476,3.14006795016988,3.1452036199095,3.13966101694915,3.14722347629797,3.14069898534386,3.14959459459459,3.13444319460067,3.14440449438202,3.14509539842873,3.14596412556054,3.13446808510638,3.14,3.14551955307263,3.13486607142857,3.13565217391304,3.13875278396437,3.14037819799778,3.13964444444444,3.14068812430633,3.14891352549889,3.13559246954596,3.13579646017699,3.14709392265193,3.13562913907285,3.14800441014333,3.14145374449339,3.14327832783278,3.14931868131868,3.14274423710209,3.13741228070175,3.14142387732749,3.14638949671772,3.14177049180328,3.15296943231441,3.153413304253,3.15420479302832,3.13653971708379,3.13421739130435,3.13837133550489,3.14720173535792,3.14301191765981,3.14324675324675,3.14162162162162,3.13922246220302,3.14360302049622,3.13926724137931,3.14032292787944,3.13741935483871,3.14758324382385,3.13450643776824,3.13166130760986,3.15708779443255,3.15174331550802,3.14260683760684,3.14574172892209,3.1289552238806,3.1444089456869,3.13978723404255,3.13895855472901,3.13923566878981,3.14451749734889,3.13724576271186,3.1394708994709,3.14807610993658,3.13875395987328,3.14991561181435,3.14554267650158,3.13423157894737,3.13951629863302,3.13634453781513,3.13569779643232,3.14758909853249,3.14073298429319,3.14548117154812,3.1475026123302,3.14818371607516,3.14723670490094,3.13083333333333,3.1436836628512,3.1377130977131,3.15576323987539,3.15609958506224,3.14569948186529,3.13937888198758,3.13849017580145,3.14099173553719,3.13514963880289,3.13641237113402,3.14121524201854,3.14489711934156,3.14425488180884,3.13967145790554,3.13989743589744,3.13930327868852,3.14088024564995,3.14200408997955,3.14439223697651,3.13840816326531,3.14788990825688,3.14118126272912,3.1589013224822,3.13882113821138,3.14058883248731,3.14547667342799,3.14083080040527,3.13991902834008,3.14139534883721,3.14230303030303,3.13909182643794,3.14326612903226,3.13796576032226,3.13983903420523,3.1369648241206,3.1414859437751,3.13644934804413,3.1314629258517,3.1449049049049,3.14328]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>반복횟수<\/th>\n      <th>원주율<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data) {\nDTWidget.formatCurrency(this, row, data, 2, '', 5, 3, ',', '.', true);\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script><!--/html_preserve-->

모의실험횟수가 증가함에 따라 위키백과사전 [원주율](https://ko.wikipedia.org/wiki/%EC%9B%90%EC%A3%BC%EC%9C%A8) 값에 수렴되는지를 
시각적으로 확인한다. 

> 원주율: "3.1415926535897932384626433832795028841971"


~~~{.r}
## 3.2. 시각화 -------------------------------

ggplot(pi_df, aes(x=반복횟수, y=원주율)) +
  geom_line() +
  theme_ipsum(base_family="NanumGothic") +
  labs(x="모의실험횟수", y="원주율값") +
  scale_x_continuous(labels = scales::comma) +
  geom_hline(yintercept = 3.1415926535897932384626433832795028841971, color="red")
~~~

<img src="fig/monte-carlo-sim-plot-1.png" style="display: block; margin: auto;" />

## 3. 몬테카를로 모의실험 시각화 {#r-monte-carlo-sim-viz}

원주율을 계산하는 몬테카를로 모의실험 결과를 시각화해보자.
1,000회 난수를 추출하여 이를 앞서 계산한 로직에 맞춰 결과값이 원내부에 위치하면 검은색 점으로,
원외부에 위치하면 붉은색 점으로 표현하여 보자.



~~~{.r}
# 4. 모의실험 1000회 시각화 ------------------------------
r <- 1
par(pty="s")
emptyplot(c(0, 0),frame.plot=r)
plotcircle(r=r, mid=c(0,0), lwd=1, lcol="blue")
lines(x=c(0,1),y=c(0,0), lty=1, col="red")
lines(x=c(-1,1),y=c(0,0), lty=2)
lines(y=c(-1,1),x=c(0,0), lty=2)
axis(1)
axis(2)
text(x=0.5,y=0.2, labels=expression("r=1"), col="red")

draw_point <- function(iter = 10) {
  
  x_pos <- runif(iter, min=-1, max=1)
  y_pos <- runif(iter, min=-1, max=1)
  
  for(i in seq_along(x_pos)) {
    if( x_pos[i]^2+y_pos[i]^2 <=1 ) {
      points(x_pos[i], y_pos[i], col="black")
    } else {
      points(x_pos[i], y_pos[i], col="red")
    }
  } 
}

draw_point(1000)
~~~

<img src="fig/monte-carlo-sim-plot-dots-1.png" style="display: block; margin: auto;" />

## 4. 함수 적분 {#monte-carlo-integration}

수학 함수의 적분 문제를 푸는데 몬테카를로 모의실험을 동원해서 보자. 
정의역이 $x \in [0,1]$으로 $x$가 0에서 1 사이이며, 함수 $f(x)$를 다음과 같이 정의해 보자.

$$f(x) = sqrt(1 - x^2 )$$

정의역 구간 $x \in [0,1]$에서 함수 $f(x)$를 적분해 보자. 즉,

$$\int_0^1 \sqrt{1 - x^2 } dx = \frac{\pi} {4}$$

자세한 수학적 증명은 [Integral of $\sqrt{1 - x^2}$ using integration by parts](https://math.stackexchange.com/questions/533082/integral-of-sqrt1-x2-using-integration-by-parts)를 참조한다.

- 부정적분: $\int \sqrt{1-x^2} = \frac{1}{2}x\sqrt{1-x^2} + \frac{1}{2} sin^{-1}x +C$
- $sin^{-1}x$: $sin^{-1}x = arcsin(1) = \frac{\pi}{2}$ 

### 4.1. 적분함수 {#integration-function}

`integrte` 함수를 활용해서 함수를 정의(`pi_fn`) 한 후 정적분 값을 통해 $\pi$ 값을 계산한다.


~~~{.r}
## 1. 수식에 대한 수치해석 -----------------
pi_fn <- function(x) sqrt(1-x^2)

integration_val <- integrate(pi_fn, 0, 1) 

integration_val$value * 4
~~~



~~~{.output}
[1] 3.141593

~~~

### 4.2. 모의 실험 {#integration-function}

함수가 정의되었다면 모의실험을 통한 결과를 시각화해보자.
$pi_fn$ 함수가 정의되어 있으니 일양분포 난수를 넣어 `pi_fn` 함수값을 계산하여 평균을 낸다.



~~~{.r}
## 2. 모의실험 -----------------

pi_sim_lst <- pi_fn(runif(n=1000000)) * 4
mean(pi_sim_lst)
~~~



~~~{.output}
[1] 3.141392

~~~



~~~{.r}
## 3. 모의실험 시각화 -----------------
par(pty="s")
curve(pi_fn, 0,1)

draw_point(1000)
~~~

<img src="fig/integrate-sim-1.png" style="display: block; margin: auto;" />
