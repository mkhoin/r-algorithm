# 데이터 과학을 위한 R 알고리즘



## 1. 기계를 활용한 원주율 계산 [^r-monte-carlo] {#pi}

[^r-monte-carlo]: [Estimating Pi with R via MCS-Dart: A very simple example of numerical integration, illustrated and computed in R.](http://giventhedata.blogspot.kr/2012/09/estimating-pi-with-r-via-mcs-dart-very.html)

컴퓨터를 활용하여 원주율을 계산하기 위해서 사각형 면적과 원면적 비율을 활용하여 원주율($\pi$)를 도출한다.

즉, 가로세로가 2인 사각형내부에 반지름이 1인 원을 내접하여 표현하면 다음과 같이 그려본다.


~~~{.r}
# library(purrr)
# library(shape)
# library(tidyverse)
# library(hrbrthemes)
# library(extrafont)
# loadfonts()

## 1.1. 반지름 1인 원 ------------------------------
r <- 1
par(pty="s")
emptyplot(c(0, 0),frame.plot=r)
plotcircle(r=r, mid=c(0,0), lwd=1, lcol="blue")
lines(x=c(0,1),y=c(0,0), lty=1, col="red")
lines(x=c(-1,1),y=c(0,0), lty=2)
lines(y=c(-1,1),x=c(0,0), lty=2)
axis(1)
axis(2)
text(x=0.5,y=0.2, labels=expression("r=1"), col="red")
~~~

<img src="fig/pi-overview-1.png" style="display: block; margin: auto;" />

피타고라스 정리를 이용하여 원 내부에 위치하면 원 내부면적에 위치하는지를 파악한다.

- $\text{원면적} = \pi \times r^2$
- $\text{정사각형면적} = {(2 \times r)}^2 = 4 \times r^2$

상기 두 면적의 비를 통하여 원주율($\pi$)를 다음과 같이 수식을 정리하여 도출한다.

$$\frac{\text{원 면적}}{\text{정사각형 면적}} = \frac{\pi \times r^2}{4 \times r^2}$$
$\pi$에 관해 수식을 정리하면 다음과 같다.

$$\pi = 4 \times \frac{\text{원 면적}}{\text{정사각형 면적}}$$



~~~{.r}
## 1.2. 피타고라스 정리 ------------------------------
### 원
emptyplot(frame.plot=r)
plotcircle(r=r, mid=c(0,0), lwd=1,lcol="blue")
lines(x=c(0,1),y=c(0,0), lty=1, col="red")
lines(x=c(-1,1),y=c(0,0), lty=2)
lines(y=c(-1,1),x=c(0,0), lty=2)
axis(1)
axis(2)

### 피타고라스 정리
points(x=0.8,y=0.58,col="red", lwd=2)
lines(x=c(0,0.8), y=c(0,0), col="red", lwd=2)
lines(x=c(0.8,0.8), y=c(0,0.58), col="red", lwd=2)
lines(x=c(0,0.8), y=c(0,0.58), col="red", lty=2,lwd=2)
text(x=0.4,y=0.4,"c",col="red")
title(expression(c == sqrt(a^2 + b^2)))
~~~

<img src="fig/pi-Pythagorean-1.png" style="display: block; margin: auto;" />

## 2. 몬테카를로 모의실험  {#r-monte-carlo-sim}

`simulate_pi` 함수를 만들어서 정사각형 길이가 2가 되기 때문에 -1에서 1사이 일양분포(uniform)에서 x, y 좌표 점을 
무작위로 뽑아내서 피타고라스 정리를 활용하여 원 내부에 위치하는지 원 외부에 위치하는지 파악한다.
이를 부울을 R 내부적으로 데이터를 표현하는 특성을 활용하여 더하면 원내부 위치하는 점의 갯수가 되고 이를 
전체 모의실험 횟수로 나누게 되면 원주율을 계산할 수 있다.


~~~{.r}
# 2. 몬테카를로 모의실험 -----------------------

simulate_pi <- function(iter = 1000) {
  
  x_pos <- runif(iter, min=-1, max=1)
  y_pos <- runif(iter, min=-1, max=1)

  xy_pos <- ifelse(x_pos^2 + y_pos^2 <= 1, TRUE, FALSE)
  
  pi_val <- 4*(sum(xy_pos)/iter)
  return(pi_val)
}

simulate_pi(1000000)
~~~



~~~{.output}
[1] 3.139988

~~~



~~~{.r}
# 3. 원주율 값 수렴 시각화  -----------------------
## 3.1. 데이터 준비 -------------------------------
sim_iter_lst <- list()

for(i in 1:10^5) {
  if(i %% 100 == 0) {
    sim_iter_lst[[length(sim_iter_lst)+1]] <- i
  }
}

iter_v <- sim_iter_lst %>% unlist
pi_v <- map(sim_iter_lst, simulate_pi) %>% unlist

pi_df <- data.frame("반복횟수"=iter_v, "원주율"=pi_v)

DT::datatable(pi_df) %>% 
  DT::formatCurrency("원주율", currency ="", interval = 3, mark = ",", digits = 5)
~~~

<!--html_preserve--><div id="htmlwidget-65d6fd1eda53b7a62e6d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-65d6fd1eda53b7a62e6d">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934","935","936","937","938","939","940","941","942","943","944","945","946","947","948","949","950","951","952","953","954","955","956","957","958","959","960","961","962","963","964","965","966","967","968","969","970","971","972","973","974","975","976","977","978","979","980","981","982","983","984","985","986","987","988","989","990","991","992","993","994","995","996","997","998","999","1000"],[100,200,300,400,500,600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000,2100,2200,2300,2400,2500,2600,2700,2800,2900,3000,3100,3200,3300,3400,3500,3600,3700,3800,3900,4000,4100,4200,4300,4400,4500,4600,4700,4800,4900,5000,5100,5200,5300,5400,5500,5600,5700,5800,5900,6000,6100,6200,6300,6400,6500,6600,6700,6800,6900,7000,7100,7200,7300,7400,7500,7600,7700,7800,7900,8000,8100,8200,8300,8400,8500,8600,8700,8800,8900,9000,9100,9200,9300,9400,9500,9600,9700,9800,9900,10000,10100,10200,10300,10400,10500,10600,10700,10800,10900,11000,11100,11200,11300,11400,11500,11600,11700,11800,11900,12000,12100,12200,12300,12400,12500,12600,12700,12800,12900,13000,13100,13200,13300,13400,13500,13600,13700,13800,13900,14000,14100,14200,14300,14400,14500,14600,14700,14800,14900,15000,15100,15200,15300,15400,15500,15600,15700,15800,15900,16000,16100,16200,16300,16400,16500,16600,16700,16800,16900,17000,17100,17200,17300,17400,17500,17600,17700,17800,17900,18000,18100,18200,18300,18400,18500,18600,18700,18800,18900,19000,19100,19200,19300,19400,19500,19600,19700,19800,19900,20000,20100,20200,20300,20400,20500,20600,20700,20800,20900,21000,21100,21200,21300,21400,21500,21600,21700,21800,21900,22000,22100,22200,22300,22400,22500,22600,22700,22800,22900,23000,23100,23200,23300,23400,23500,23600,23700,23800,23900,24000,24100,24200,24300,24400,24500,24600,24700,24800,24900,25000,25100,25200,25300,25400,25500,25600,25700,25800,25900,26000,26100,26200,26300,26400,26500,26600,26700,26800,26900,27000,27100,27200,27300,27400,27500,27600,27700,27800,27900,28000,28100,28200,28300,28400,28500,28600,28700,28800,28900,29000,29100,29200,29300,29400,29500,29600,29700,29800,29900,30000,30100,30200,30300,30400,30500,30600,30700,30800,30900,31000,31100,31200,31300,31400,31500,31600,31700,31800,31900,32000,32100,32200,32300,32400,32500,32600,32700,32800,32900,33000,33100,33200,33300,33400,33500,33600,33700,33800,33900,34000,34100,34200,34300,34400,34500,34600,34700,34800,34900,35000,35100,35200,35300,35400,35500,35600,35700,35800,35900,36000,36100,36200,36300,36400,36500,36600,36700,36800,36900,37000,37100,37200,37300,37400,37500,37600,37700,37800,37900,38000,38100,38200,38300,38400,38500,38600,38700,38800,38900,39000,39100,39200,39300,39400,39500,39600,39700,39800,39900,40000,40100,40200,40300,40400,40500,40600,40700,40800,40900,41000,41100,41200,41300,41400,41500,41600,41700,41800,41900,42000,42100,42200,42300,42400,42500,42600,42700,42800,42900,43000,43100,43200,43300,43400,43500,43600,43700,43800,43900,44000,44100,44200,44300,44400,44500,44600,44700,44800,44900,45000,45100,45200,45300,45400,45500,45600,45700,45800,45900,46000,46100,46200,46300,46400,46500,46600,46700,46800,46900,47000,47100,47200,47300,47400,47500,47600,47700,47800,47900,48000,48100,48200,48300,48400,48500,48600,48700,48800,48900,49000,49100,49200,49300,49400,49500,49600,49700,49800,49900,50000,50100,50200,50300,50400,50500,50600,50700,50800,50900,51000,51100,51200,51300,51400,51500,51600,51700,51800,51900,52000,52100,52200,52300,52400,52500,52600,52700,52800,52900,53000,53100,53200,53300,53400,53500,53600,53700,53800,53900,54000,54100,54200,54300,54400,54500,54600,54700,54800,54900,55000,55100,55200,55300,55400,55500,55600,55700,55800,55900,56000,56100,56200,56300,56400,56500,56600,56700,56800,56900,57000,57100,57200,57300,57400,57500,57600,57700,57800,57900,58000,58100,58200,58300,58400,58500,58600,58700,58800,58900,59000,59100,59200,59300,59400,59500,59600,59700,59800,59900,60000,60100,60200,60300,60400,60500,60600,60700,60800,60900,61000,61100,61200,61300,61400,61500,61600,61700,61800,61900,62000,62100,62200,62300,62400,62500,62600,62700,62800,62900,63000,63100,63200,63300,63400,63500,63600,63700,63800,63900,64000,64100,64200,64300,64400,64500,64600,64700,64800,64900,65000,65100,65200,65300,65400,65500,65600,65700,65800,65900,66000,66100,66200,66300,66400,66500,66600,66700,66800,66900,67000,67100,67200,67300,67400,67500,67600,67700,67800,67900,68000,68100,68200,68300,68400,68500,68600,68700,68800,68900,69000,69100,69200,69300,69400,69500,69600,69700,69800,69900,70000,70100,70200,70300,70400,70500,70600,70700,70800,70900,71000,71100,71200,71300,71400,71500,71600,71700,71800,71900,72000,72100,72200,72300,72400,72500,72600,72700,72800,72900,73000,73100,73200,73300,73400,73500,73600,73700,73800,73900,74000,74100,74200,74300,74400,74500,74600,74700,74800,74900,75000,75100,75200,75300,75400,75500,75600,75700,75800,75900,76000,76100,76200,76300,76400,76500,76600,76700,76800,76900,77000,77100,77200,77300,77400,77500,77600,77700,77800,77900,78000,78100,78200,78300,78400,78500,78600,78700,78800,78900,79000,79100,79200,79300,79400,79500,79600,79700,79800,79900,80000,80100,80200,80300,80400,80500,80600,80700,80800,80900,81000,81100,81200,81300,81400,81500,81600,81700,81800,81900,82000,82100,82200,82300,82400,82500,82600,82700,82800,82900,83000,83100,83200,83300,83400,83500,83600,83700,83800,83900,84000,84100,84200,84300,84400,84500,84600,84700,84800,84900,85000,85100,85200,85300,85400,85500,85600,85700,85800,85900,86000,86100,86200,86300,86400,86500,86600,86700,86800,86900,87000,87100,87200,87300,87400,87500,87600,87700,87800,87900,88000,88100,88200,88300,88400,88500,88600,88700,88800,88900,89000,89100,89200,89300,89400,89500,89600,89700,89800,89900,90000,90100,90200,90300,90400,90500,90600,90700,90800,90900,91000,91100,91200,91300,91400,91500,91600,91700,91800,91900,92000,92100,92200,92300,92400,92500,92600,92700,92800,92900,93000,93100,93200,93300,93400,93500,93600,93700,93800,93900,94000,94100,94200,94300,94400,94500,94600,94700,94800,94900,95000,95100,95200,95300,95400,95500,95600,95700,95800,95900,96000,96100,96200,96300,96400,96500,96600,96700,96800,96900,97000,97100,97200,97300,97400,97500,97600,97700,97800,97900,98000,98100,98200,98300,98400,98500,98600,98700,98800,98900,99000,99100,99200,99300,99400,99500,99600,99700,99800,99900,100000],[3.32,3.22,3.22666666666667,3.26,3.08,2.98666666666667,3.09714285714286,3.215,3.17777777777778,3.196,3.09818181818182,3.2,3.15384615384615,3.08571428571429,3.12266666666667,3.14,3.16,3.17333333333333,3.18105263157895,3.128,3.11809523809524,3.1,3.12347826086957,3.11666666666667,3.1168,3.15692307692308,3.11407407407407,3.14,3.19586206896552,3.172,3.16387096774194,3.13,3.09575757575758,3.09529411764706,3.15428571428571,3.14777777777778,3.14054054054054,3.15368421052632,3.14769230769231,3.145,3.15609756097561,3.19428571428571,3.14418604651163,3.14454545454545,3.13866666666667,3.13478260869565,3.18723404255319,3.14916666666667,3.12408163265306,3.0896,3.15921568627451,3.16384615384615,3.14566037735849,3.11703703703704,3.09163636363636,3.11857142857143,3.14105263157895,3.13931034482759,3.11796610169492,3.14333333333333,3.17704918032787,3.16,3.16634920634921,3.174375,3.12307692307692,3.1569696969697,3.11582089552239,3.16764705882353,3.17101449275362,3.15885714285714,3.14197183098592,3.13611111111111,3.14356164383562,3.1427027027027,3.1616,3.12368421052632,3.12675324675325,3.13230769230769,3.15291139240506,3.1285,3.12888888888889,3.12585365853659,3.14265060240964,3.12,3.12141176470588,3.12232558139535,3.15218390804598,3.13272727272727,3.14067415730337,3.15155555555556,3.12659340659341,3.17434782608696,3.12688172043011,3.13914893617021,3.18021052631579,3.13791666666667,3.1360824742268,3.16285714285714,3.1220202020202,3.1672,3.15089108910891,3.13607843137255,3.13087378640777,3.12384615384615,3.13714285714286,3.1411320754717,3.16785046728972,3.1237037037037,3.16110091743119,3.15963636363636,3.13117117117117,3.14142857142857,3.15893805309735,3.15614035087719,3.15686956521739,3.15344827586207,3.12581196581197,3.13966101694915,3.13210084033613,3.122,3.12892561983471,3.16524590163934,3.13463414634146,3.15322580645161,3.13728,3.13555555555556,3.12692913385827,3.1296875,3.14976744186047,3.14984615384615,3.12977099236641,3.14363636363636,3.12390977443609,3.13253731343284,3.16177777777778,3.12411764705882,3.13051094890511,3.1304347826087,3.16863309352518,3.16114285714286,3.13787234042553,3.1369014084507,3.14741258741259,3.12222222222222,3.13158620689655,3.13753424657534,3.14068027210884,3.12675675675676,3.16644295302013,3.1656,3.13456953642384,3.13552631578947,3.16392156862745,3.15012987012987,3.14038709677419,3.14230769230769,3.13605095541401,3.1526582278481,3.14767295597484,3.12175,3.1344099378882,3.10666666666667,3.12711656441718,3.15439024390244,3.11951515151515,3.12265060240964,3.14131736526946,3.15809523809524,3.15076923076923,3.12188235294118,3.11812865497076,3.14,3.13780346820809,3.13448275862069,3.14102857142857,3.14204545454545,3.13875706214689,3.12629213483146,3.14011173184358,3.136,3.1414364640884,3.15054945054945,3.14295081967213,3.16739130434783,3.14335135135135,3.1,3.15614973262032,3.13021276595745,3.12994708994709,3.14526315789474,3.15539267015707,3.13229166666667,3.14735751295337,3.13484536082474,3.13497435897436,3.16469387755102,3.13786802030457,3.1440404040404,3.14653266331658,3.1284,3.13611940298507,3.12712871287129,3.14995073891626,3.12862745098039,3.14556097560976,3.11708737864078,3.13545893719807,3.11,3.14717703349282,3.14361904761905,3.13194312796209,3.12981132075472,3.15474178403756,3.13943925233645,3.15609302325581,3.1312962962963,3.12516129032258,3.11302752293578,3.14520547945205,3.15709090909091,3.15239819004525,3.13873873873874,3.13112107623318,3.15321428571429,3.13546666666667,3.13522123893805,3.13074889867841,3.15245614035088,3.13379912663755,3.15530434782609,3.14753246753247,3.13068965517241,3.14557939914163,3.14581196581197,3.14689361702128,3.14525423728814,3.14278481012658,3.14436974789916,3.11799163179916,3.143,3.14240663900415,3.14264462809917,3.15917695473251,3.16426229508197,3.14938775510204,3.15414634146341,3.13441295546559,3.14209677419355,3.14875502008032,3.15616,3.13657370517928,3.14571428571429,3.12648221343874,3.15842519685039,3.15152941176471,3.139375,3.14038910505837,3.14527131782946,3.15196911196911,3.13123076923077,3.15172413793103,3.13236641221374,3.13095057034221,3.1469696969697,3.15230188679245,3.14781954887218,3.12044943820225,3.14268656716418,3.14379182156134,3.14814814814815,3.13667896678967,3.14764705882353,3.13054945054945,3.14919708029197,3.13192727272727,3.13449275362319,3.15379061371841,3.14532374100719,3.1278853046595,3.14342857142857,3.15672597864769,3.13517730496454,3.14671378091873,3.1312676056338,3.1539649122807,3.15902097902098,3.1616724738676,3.1425,3.13550173010381,3.14413793103448,3.1439175257732,3.14068493150685,3.14470989761092,3.14843537414966,3.144,3.13702702702703,3.15151515151515,3.14268456375839,3.13324414715719,3.14866666666667,3.13395348837209,3.14423841059603,3.13478547854785,3.15184210526316,3.15344262295082,3.15385620915033,3.14045602605863,3.16467532467532,3.14485436893204,3.15690322580645,3.14752411575563,3.15051282051282,3.1473482428115,3.13414012738854,3.15314285714286,3.13544303797468,3.14056782334385,3.11949685534591,3.14457680250784,3.142,3.15314641744548,3.14534161490683,3.14117647058824,3.16543209876543,3.13710769230769,3.14134969325153,3.14140672782875,3.13682926829268,3.15355623100304,3.13830303030303,3.1563746223565,3.15481927710843,3.1563963963964,3.14311377245509,3.152,3.12940476190476,3.13566765578635,3.12532544378698,3.13734513274336,3.14682352941176,3.13841642228739,3.12233918128655,3.14857142857143,3.14639534883721,3.1495652173913,3.15421965317919,3.13613832853026,3.14241379310345,3.16160458452722,3.14217142857143,3.14917378917379,3.14920454545455,3.14447592067989,3.14429378531073,3.14839436619718,3.13483146067416,3.13983193277311,3.13117318435754,3.12267409470752,3.13522222222222,3.14759002770083,3.14685082872928,3.15845730027548,3.12450549450549,3.15758904109589,3.14655737704918,3.13678474114441,3.13815217391304,3.15284552845528,3.15210810810811,3.15148247978437,3.13462365591398,3.15281501340483,3.1131550802139,3.13738666666667,3.13702127659574,3.13379310344828,3.1237037037037,3.13171503957784,3.13715789473684,3.12199475065617,3.14094240837696,3.14642297650131,3.15010416666667,3.16238961038961,3.13647668393782,3.13664082687339,3.12896907216495,3.14077120822622,3.14574358974359,3.13248081841432,3.14704081632653,3.14310432569975,3.15035532994924,3.13924050632911,3.13242424242424,3.15476070528967,3.15336683417085,3.14235588972431,3.1378,3.14673316708229,3.15522388059701,3.15682382133995,3.13376237623762,3.13748148148148,3.13891625615764,3.15154791154791,3.13725490196078,3.15110024449878,3.14751219512195,3.13936739659367,3.14320388349515,3.13191283292978,3.14280193236715,3.13224096385542,3.13769230769231,3.14599520383693,3.1222009569378,3.15245823389021,3.14171428571429,3.1483135391924,3.15582938388626,3.1486524822695,3.14622641509434,3.14983529411765,3.14394366197183,3.14220140515222,3.12700934579439,3.12689976689977,3.13851162790698,3.15062645011601,3.13805555555556,3.14512702078522,3.15391705069124,3.13140229885057,3.1454128440367,3.14718535469108,3.13954337899543,3.13949886104784,3.14163636363636,3.1265306122449,3.14461538461538,3.153769751693,3.15009009009009,3.14004494382022,3.13713004484305,3.1289485458613,3.14651785714286,3.15608017817372,3.13964444444444,3.14678492239468,3.14159292035398,3.14578366445916,3.14211453744493,3.15771428571429,3.12789473684211,3.13557986870897,3.14296943231441,3.13760348583878,3.13713043478261,3.14091106290672,3.15212121212121,3.13805615550756,3.14181034482759,3.1327311827957,3.14918454935622,3.12428265524625,3.14820512820513,3.1397867803838,3.13063829787234,3.14259023354565,3.14466101694915,3.14680761099366,3.14210970464135,3.14004210526316,3.13252100840336,3.13215932914046,3.14167364016736,3.14906054279749,3.1565,3.14503118503118,3.14448132780083,3.14616977225673,3.13214876033058,3.15257731958763,3.14189300411523,3.14924024640657,3.15008196721311,3.14715746421268,3.14636734693878,3.13979633401222,3.14926829268293,3.13265720081136,3.13417004048583,3.13769696969697,3.13701612903226,3.12611670020121,3.1404016064257,3.13731462925852,3.13704,3.15872255489022,3.14342629482072,3.13709741550696,3.12515873015873,3.13813861386139,3.12719367588933,3.14785009861933,3.13669291338583,3.14734774066798,3.14729411764706,3.14551859099804,3.141171875,3.13762183235867,3.1504280155642,3.15005825242718,3.14372093023256,3.1431334622824,3.14108108108108,3.1409633911368,3.13992307692308,3.14295585412668,3.14521072796935,3.13682600382409,3.13809160305343,3.14087619047619,3.13802281368821,3.13783681214421,3.14098484848485,3.13837429111531,3.14883018867925,3.14998116760829,3.13503759398496,3.13163227016886,3.1476404494382,3.14056074766355,3.14470149253731,3.14443202979516,3.13375464684015,3.13432282003711,3.13437037037037,3.13988909426987,3.13638376383764,3.15447513812155,3.14485294117647,3.14223853211009,3.1440293040293,3.12892138939671,3.12124087591241,3.13311475409836,3.15963636363636,3.13880217785844,3.13898550724638,3.15023508137432,3.15285198555957,3.1421981981982,3.13187050359712,3.14922800718133,3.14487455197133,3.1506976744186,3.15192857142857,3.13590017825312,3.13537366548043,3.14813499111901,3.13163120567376,3.14775221238938,3.13660777385159,3.14708994708995,3.14387323943662,3.1528295254833,3.14154385964912,3.13323992994746,3.14174825174825,3.14059336823735,3.12940766550523,3.13704347826087,3.14305555555556,3.14273830155979,3.14401384083045,3.14632124352332,3.1388275862069,3.14354561101549,3.14659793814433,3.13420240137221,3.14232876712329,3.13859829059829,3.1481228668942,3.13744463373083,3.13857142857143,3.16237691001698,3.13742372881356,3.13604060913706,3.14716216216216,3.14360876897133,3.13872053872054,3.15166386554622,3.13691275167785,3.14994974874372,3.13732441471572,3.13562604340568,3.1438,3.14296173044925,3.14564784053156,3.14865671641791,3.1517880794702,3.13745454545455,3.14752475247525,3.14602965403624,3.14019736842105,3.13668308702791,3.14183606557377,3.14932896890344,3.14666666666667,3.14616639477977,3.13837133550489,3.13847154471545,3.13668831168831,3.14755267423015,3.14265372168285,3.14436187399031,3.14361290322581,3.15227053140097,3.15395498392283,3.13470304975923,3.14551282051282,3.136896,3.13840255591054,3.13741626794258,3.13738853503185,3.14302066772655,3.14863492063492,3.14263074484945,3.1323417721519,3.14818325434439,3.14328075709779,3.14992125984252,3.1485534591195,3.13180533751962,3.14890282131661,3.14541471048513,3.1404375,3.14552262090484,3.14461059190031,3.14264385692068,3.14478260869565,3.13451162790698,3.1353560371517,3.14775888717156,3.14858024691358,3.14693374422188,3.13532307692308,3.13757296466974,3.13619631901841,3.14027565084227,3.13535168195719,3.14045801526718,3.14914634146341,3.14605783866058,3.13756838905775,3.12922610015175,3.15060606060606,3.15134644478064,3.15244712990937,3.13870286576169,3.14433734939759,3.13732330827068,3.14432432432432,3.14200899550225,3.14562874251497,3.13518684603886,3.15116417910448,3.13502235469449,3.14386904761905,3.13087667161961,3.1313353115727,3.1504,3.14230769230769,3.13660265878877,3.14424778761062,3.14845360824742,3.14517647058824,3.13509544787078,3.14768328445748,3.14910688140556,3.14286549707602,3.13383941605839,3.14104956268222,3.14334788937409,3.13947674418605,3.14304789550073,3.13692753623188,3.13580318379161,3.13878612716763,3.1441847041847,3.14028818443804,3.14457553956835,3.14591954022988,3.1438737446198,3.14017191977077,3.14792560801145,3.13611428571429,3.13991440798859,3.14797720797721,3.13593172119488,3.14670454545455,3.14876595744681,3.1357507082153,3.1378783592645,3.14717514124294,3.14504936530324,3.12935211267606,3.14210970464135,3.14657303370787,3.14244039270687,3.13372549019608,3.13840559440559,3.13826815642458,3.15425383542538,3.14323119777159,3.13808066759388,3.14761111111111,3.14435506241331,3.14781163434903,3.14412171507607,3.1432044198895,3.14659310344828,3.14132231404959,3.14239339752407,3.14423076923077,3.13750342935528,3.13424657534247,3.13515731874145,3.15568306010929,3.13396998635744,3.14899182561308,3.13257142857143,3.13847826086957,3.14312075983718,3.14162601626016,3.14376184032476,3.1427027027027,3.14364372469636,3.13902964959569,3.14514131897712,3.14048387096774,3.14598657718121,3.12316353887399,3.13954484605087,3.15336898395722,3.13303070761015,3.14325333333333,3.13256990679095,3.14654255319149,3.1403984063745,3.14525198938992,3.14267549668874,3.14,3.13231175693527,3.13736147757256,3.13217391304348,3.14478947368421,3.14370565045992,3.1298687664042,3.13342070773263,3.14659685863874,3.13971241830065,3.13331592689295,3.13877444589309,3.14020833333333,3.14252275682705,3.14493506493507,3.13888456549935,3.14051813471503,3.13904269081501,3.14175710594315,3.1405935483871,3.14036082474227,3.13930501930502,3.14416452442159,3.13170731707317,3.14435897435897,3.13864276568502,3.13529411764706,3.13532567049808,3.13137755102041,3.14262420382166,3.13791348600509,3.1359085133418,3.14690355329949,3.14453738910013,3.14724050632911,3.14670037926675,3.14686868686869,3.14279949558638,3.13949622166247,3.13620125786164,3.13979899497487,3.14996235884567,3.14401002506266,3.14332916145181,3.14295,3.13802746566792,3.14284289276808,3.14510585305106,3.14422885572139,3.15234782608696,3.13111662531017,3.13789343246592,3.14321782178218,3.14798516687268,3.14192592592593,3.13958076448829,3.13364532019704,3.13682656826568,3.14884520884521,3.14041717791411,3.14254901960784,3.13742962056304,3.14611246943765,3.13758241758242,3.13346341463415,3.13354445797808,3.1345498783455,3.14814094775213,3.14373786407767,3.14715151515152,3.14019370460048,3.14539298669891,3.12608695652174,3.1416164053076,3.15233734939759,3.14238267148014,3.15004807692308,3.13171668667467,3.13827338129496,3.14960479041916,3.14081339712919,3.13696535244922,3.14085918854415,3.13344457687723,3.1452380952381,3.14325802615933,3.1412351543943,3.15193357058126,3.14379146919431,3.13789349112426,3.14146572104019,3.13671782762692,3.1452358490566,3.13936395759717,3.13816470588235,3.15074030552291,3.13882629107981,3.1473856975381,3.14042154566745,3.14764912280702,3.13873831775701,3.15631271878646,3.14191142191142,3.14086146682189,3.14576744186047,3.14072009291522,3.14352668213457,3.14224797219003,3.13615740740741,3.14492485549133,3.13408775981524,3.13351787773933,3.14276497695853,3.13698504027618,3.14795402298851,3.1435132032147,3.1495871559633,3.15028636884307,3.14855835240275,3.14427428571429,3.1389497716895,3.14161915621437,3.12574031890661,3.14298065984073,3.13318181818182,3.13916004540295,3.13337868480726,3.14532276330691,3.14638009049774,3.13247457627119,3.13918735891648,3.1343404735062,3.13815315315315,3.14933633295838,3.13932584269663,3.14482603815937,3.14367713004484,3.15440089585666,3.14456375838926,3.13184357541899,3.139375,3.14804905239688,3.14467706013363,3.14611790878754,3.14591111111111,3.14024417314095,3.14208425720621,3.14068660022148,3.13805309734513,3.14338121546961,3.14503311258278,3.13724366041896,3.134140969163,3.13645764576458,3.13063736263736,3.14915477497256,3.14622807017544,3.13568455640745,3.14468271334792,3.14334426229508,3.13860262008734,3.12998909487459,3.13681917211329,3.14346028291621,3.14147826086957,3.14731813246471,3.14247288503254,3.14296858071506,3.14134199134199,3.14581621621622,3.14436285097192,3.13467098166127,3.14288793103448,3.14415500538213,3.1378064516129,3.14268528464017,3.13738197424893,3.14829581993569,3.14064239828694,3.1436577540107,3.14038461538462,3.1369477054429,3.14204690831557,3.14453674121406,3.138,3.14609989373007,3.14292993630573,3.12882290562036,3.13949152542373,3.13951322751323,3.14663847780127,3.13883843717001,3.14447257383966,3.14187565858799,3.12686315789474,3.13976866456362,3.14542016806723,3.14060860440714,3.14859538784067,3.12490052356021,3.15225941422594,3.13993730407523,3.1427139874739,3.14185610010428,3.14004166666667,3.14131113423517,3.13463617463617,3.13835929387331,3.13730290456432,3.14565803108808,3.14600414078675,3.15900723888314,3.13789256198347,3.14146542827657,3.14696907216495,3.14525231719876,3.13843621399177,3.13558067831449,3.13720739219713,3.14293333333333,3.14155737704918,3.14517911975435,3.14588957055215,3.13756894790603,3.14775510204082,3.14532110091743,3.1406517311609,3.14026449643947,3.13792682926829,3.14684263959391,3.13858012170385,3.13017223910841,3.14619433198381,3.13334681496461,3.13006060606061,3.14785065590313,3.14116935483871,3.14779456193353,3.14189134808853,3.14291457286432,3.13987951807229,3.14455366098295,3.13575150300601,3.14086086086086,3.14148]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>반복횟수<\/th>\n      <th>원주율<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data) {\nDTWidget.formatCurrency(this, row, data, 2, '', 5, 3, ',', '.', true);\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script><!--/html_preserve-->

모의실험횟수가 증가함에 따라 위키백과사전 [원주율](https://ko.wikipedia.org/wiki/%EC%9B%90%EC%A3%BC%EC%9C%A8) 값에 수렴되는지를 
시각적으로 확인한다. 

> 원주율: "3.1415926535897932384626433832795028841971"


~~~{.r}
## 3.2. 시각화 -------------------------------

ggplot(pi_df, aes(x=반복횟수, y=원주율)) +
  geom_line() +
  theme_ipsum(base_family="NanumGothic") +
  labs(x="모의실험횟수", y="원주율값") +
  scale_x_continuous(labels = scales::comma) +
  geom_hline(yintercept = 3.1415926535897932384626433832795028841971, color="red")
~~~

<img src="fig/monte-carlo-sim-plot-1.png" style="display: block; margin: auto;" />

## 3. 몬테카를로 모의실험 시각화 {#r-monte-carlo-sim-viz}

원주율을 계산하는 몬테카를로 모의실험 결과를 시각화해보자.
1,000회 난수를 추출하여 이를 앞서 계산한 로직에 맞춰 결과값이 원내부에 위치하면 검은색 점으로,
원외부에 위치하면 붉은색 점으로 표현하여 보자.



~~~{.r}
# 4. 모의실험 1000회 시각화 ------------------------------
r <- 1
par(pty="s")
emptyplot(c(0, 0),frame.plot=r)
plotcircle(r=r, mid=c(0,0), lwd=1, lcol="blue")
lines(x=c(0,1),y=c(0,0), lty=1, col="red")
lines(x=c(-1,1),y=c(0,0), lty=2)
lines(y=c(-1,1),x=c(0,0), lty=2)
axis(1)
axis(2)
text(x=0.5,y=0.2, labels=expression("r=1"), col="red")

draw_point <- function(iter = 10) {
  
  x_pos <- runif(iter, min=-1, max=1)
  y_pos <- runif(iter, min=-1, max=1)
  
  for(i in seq_along(x_pos)) {
    if( x_pos[i]^2+y_pos[i]^2 <=1 ) {
      points(x_pos[i], y_pos[i], col="black")
    } else {
      points(x_pos[i], y_pos[i], col="red")
    }
  } 
}

draw_point(1000)
~~~

<img src="fig/monte-carlo-sim-plot-dots-1.png" style="display: block; margin: auto;" />

## 4. 함수 적분 {#monte-carlo-integration}

수학 함수의 적분 문제를 푸는데 몬테카를로 모의실험을 동원해서 보자. 
정의역이 $x \in [0,1]$으로 $x$가 0에서 1 사이이며, 함수 $f(x)$를 다음과 같이 정의해 보자.

$$f(x) = /sqrt{1 - x^2 }$$

정의역 구간 $x \in [0,1]$에서 함수 $f(x)$를 적분해 보자. 즉,

$$\int_0^1 \sqrt{1 - x^2 } dx = \frac{\pi} {4}$$

자세한 수학적 증명은 [Integral of $\sqrt{1 - x^2}$ using integration by parts](https://math.stackexchange.com/questions/533082/integral-of-sqrt1-x2-using-integration-by-parts)를 참조한다.

- 부정적분: $\int \sqrt{1-x^2} = \frac{1}{2}x\sqrt{1-x^2} + \frac{1}{2} sin^{-1}x +C$
- $sin^{-1}x$: $sin^{-1}x = arcsin(1) = \frac{\pi}{2}$ 

### 4.1. 적분함수 {#integration-function}

`integrte` 함수를 활용해서 함수를 정의(`pi_fn`) 한 후 정적분 값을 통해 $\pi$ 값을 계산한다.


~~~{.r}
## 1. 수식에 대한 수치해석 -----------------
pi_fn <- function(x) sqrt(1-x^2)

integration_val <- integrate(pi_fn, 0, 1) 

integration_val$value * 4
~~~



~~~{.output}
[1] 3.141593

~~~

### 4.2. 모의 실험 {#integration-function}

함수가 정의되었다면 모의실험을 통한 결과를 시각화해보자.
$pi_fn$ 함수가 정의되어 있으니 일양분포 난수를 넣어 `pi_fn` 함수값을 계산하여 평균을 낸다.



~~~{.r}
## 2. 모의실험 -----------------

pi_sim_lst <- pi_fn(runif(n=1000000)) * 4
mean(pi_sim_lst)
~~~



~~~{.output}
[1] 3.140017

~~~



~~~{.r}
## 3. 모의실험 시각화 -----------------
par(pty="s")
curve(pi_fn, 0,1)

draw_point(1000)
~~~

<img src="fig/integrate-sim-1.png" style="display: block; margin: auto;" />

## 5. 뷔퐁 바늘(Buffon Needle) {#buffon-need}

[뷔퐁의 바늘](https://ko.wikipedia.org/wiki/%EB%B7%94%ED%90%81%EC%9D%98_%EB%B0%94%EB%8A%98)은 18세기에 뷔퐁 백작이 처음 제기한 문제로,
너비가 모두 같은 평행한 목재 널빤을 깔아 만든 마루가 있을 때, 그 마루 위에 바늘을 떨어뜨린다. 바늘이 널빤과 널빤 사이의 선을 가로지어 걸칠 확률은 얼마인가?
기하학 지식과 적분 지식을 가지고 수학적으로 풀 수도 있고, 컴퓨터를 활용하여 몬테카를로 모의 실험을 통해 **원주율($\pi$)**을 구할수 있다.

<img src="fig/buffon-needle.png" alt="뷔퐁 바늘" width="77%" />

- 바늘 가운데에서 가장 가까운 평행선까지의 거리를 $d$로 정의: $d = \left[ 0, { t \over 2} \right]$
- 바늘과 평행선 사이 각도를 $\theta$로 정의: $\theta = \left[ 0, { \pi \over 2} \right]$
- 바늘이 선을 가로질러 걸칠 조건: $d \le \frac{l}{2}\sin\theta$

$d, \theta$가 독립이기 때문에 결합확률분포함수를 적분하면 답을 구할 수 있다.

$$P(\frac{sin\theta}{2}>d) = \int_{0}^{\pi} \frac{sin \theta}{2} d \theta = \frac{-cos\theta}{2} \Big|^{\pi}_{0} = 1$$

확률을 구하게 되면 $\frac{\text{내부 면적}}{\text{사각형 면적}} = \frac{\frac{2}{2}}{\frac{\pi}{2}}=\frac{2}{\pi}$ 가 된다.

<iframe width="300" height="180" src="https://www.youtube.com/embed/sJVivjuMfWA" frameborder="0" allowfullscreen></iframe>

### 5.1. 뷔퐁 바늘 모의실험 애니메이션 {#buffon-need-animation}

`animation` 팩키지 내부에 뷔퐁 바늘 모의실험 함수가 있어 이를 실행해서 뷔퐁 바늘 모의실험을 통해 $\pi$가 계산되는 과정을 확인할 수 있다. 자세한 사항 [Simulation of Buffons Needle](https://yihui.name/animation/example/buffon-needle/) 참조한다.
`ani.options(nmax = 1, 1)` 명령어 `nmax=100` 인자를 조정하면 애니메이션을 확인할 수 있다.


~~~{.r}
#library(animation)
ani.options(nmax = 1, 1)
par(mar = c(3, 2.5, 0.5, 0.2), pch = 20, mgp = c(1.5, 0.5, 0))
buffon.needle()
~~~

<img src="fig/buffon-needle-ani-1.png" style="display: block; margin: auto;" />

### 5.2. 뷔퐁 바늘 모의실험 [^buffon-needle-sim-rcode] {#buffon-need-simulation}

[^buffon-needle-sim-rcode]: [Calculating Pi using Buffon's Needle](http://www.exegetic.biz/blog/2016/07/calculating-pi-using-buffons-needle/)


~~~{.r}
buffon_needle_sim <- function(needle_len=1, line_spacing=2) {
  distance <- runif(1, min = 0, max = line_spacing / 2)
  theta <- runif(1, 0, pi / 2)
  is_crossed <- distance <= needle_len / 2 * sin(theta)
  return(is_crossed)
}

is_crossed <- replicate(10^7, buffon_needle_sim(1, 2))

10^7 / sum(is_crossed)
~~~



~~~{.output}
[1] 3.139509

~~~



